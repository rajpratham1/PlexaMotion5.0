<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlexaMotion 5.0 | Real-Time Body Tracking</title>
    <meta name="description" content="Futuristic Real-Time Body Tracking & Environment Detection Web App">

    <!-- Google Fonts for Futuristic Look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Rajdhani:wght@300;500;700&display=swap"
        rel="stylesheet">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="logo.svg">
    <meta name="theme-color" content="#0a192f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <link rel="stylesheet" href="style.css">

    <!-- MediaPipe Styles -->
    <style>
        .mediapipe-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
        }

        .video-feed {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
            /* Mirror effect */
            border-radius: 12px;
        }
    </style>
</head>

<body>

    <div class="app-container">

        <!-- Header -->
        <header class="glass-header">
            <div class="logo-area">
                <img src="logo.svg" alt="PlexaMotion Logo" class="logo-icon"/>
                <div>
                    <h1>PlexaMotion 5.0</h1>
                    <p class="subtitle">Real-Time Body & Motion Intelligence</p>
                </div>
            </div>
            <div class="system-status">
                <span class="status-dot"></span> System Active
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-grid">

            <!-- Left Panel: Vision Feed -->
            <section class="vision-panel glass-card">
                <div class="vision-header">
                    <h2><span class="material-icons">videocam</span> Live Feed</h2>
                    <div class="live-indicator">LIVE</div>
                </div>

                <div class="video-container" id="videoContainer">
                    <div class="loading-overlay" id="loadingScreen">
                        <div class="spinner"></div>
                        <p>Initializing Neural Core...</p>
                    </div>
                    <button id="cameraToggle" class="camera-toggle-btn" title="Switch Camera">
                        <span class="material-icons">flip_camera_ios</span>
                    </button>
                    <button id="mirrorToggle" class="mirror-toggle-btn" title="Mirror View">
                        <span class="material-icons">flip</span>
                    </button>
                    <video id="webcam" class="video-feed" autoplay playsinline></video>
                    <canvas id="output_canvas" class="mediapipe-canvas"></canvas>

                    <!-- Game UI Overlay -->
                    <div id="gameOverlay" class="hidden">
                        <div id="gameStartScreen" class="game-ui-screen">
                            <h2>Motion Dodge</h2>
                            <p>Move your body to dodge the falling blocks!</p>
                            <button id="startGameButton" class="action-btn">Start Game</button>
                        </div>
                        <div id="gameHud" class="hidden">
                            <div class="hud-item">
                                Score: <span id="gameScore">0</span>
                            </div>
                        </div>
                        <div id="gameOverScreen" class="game-ui-screen hidden">
                            <h2>Game Over</h2>
                            <p>Final Score: <span id="finalScore">0</span></p>
                            <button id="restartGameButton" class="action-btn">Restart</button>
                        </div>
                    </div>

                    <!-- Gesture Control UI Overlay -->
                    <div id="gestureOverlay" class="hidden">
                        <div class="gallery-container">
                            <div class="gallery-item active" style="background-image: url('https://picsum.photos/id/10/800/600')"></div>
                            <div class="gallery-item" style="background-image: url('https://picsum.photos/id/20/800/600')"></div>
                            <div class="gallery-item" style="background-image: url('https://picsum.photos/id/30/800/600')"></div>
                            <div class="gallery-item" style="background-image: url('https://picsum.photos/id/40/800/600')"></div>
                        </div>
                        <div id="gesture-instructions">
                            <span class="material-icons">waving_hand</span>
                            <p>Swipe your hand left or right to navigate</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Right Panel: Intelligence Dashboard -->
            <aside class="dashboard-panel">

                <!-- Card for Fitness AI -->
                <div id="fitnessPanel" class="glass-card stat-card hidden">
                    <div class="card-title">
                        <span class="material-icons">fitness_center</span> Fitness AI
                    </div>
                    <div class="exercise-display">
                        <span id="exerciseName">Squats</span>
                    </div>
                    <div class="rep-counter">
                        <span id="repCount">0</span> Reps
                    </div>
                    <div class="feedback-box">
                        <span class="material-icons">info</span>
                        <span id="formFeedback">Start your workout!</span>
                    </div>
                </div>

                <!-- Card 1: Body Tracking Status -->
                <div class="glass-card stat-card glow-blue">
                    <div class="card-title">
                        <span class="material-icons">directions_walk</span> Body Tracking
                    </div>
                    <div class="card-value" id="bodyStatus">Searching...</div>
                    <div class="card-sub">Confidence: <span id="confidenceScore">0%</span></div>
                </div>

                <!-- Card 2: Environment Detection -->
                <div class="glass-card stat-card glow-cyan">
                    <div class="card-title">
                        <span class="material-icons">public</span> Environment
                    </div>
                    <div class="card-value neon-text" id="envStatus">Scanning...</div>
                    <div class="coords-grid">
                        <div class="coord-item">
                            <span class="label">LAT</span>
                            <span class="val" id="latVal">--.----</span>
                        </div>
                        <div class="coord-item">
                            <span class="label">LON</span>
                            <span class="val" id="lonVal">--.----</span>
                        </div>
                    </div>
                </div>

                <!-- Card 3: Performance -->
                <div class="glass-card stat-card">
                    <div class="card-title">
                        <span class="material-icons">speed</span> Performance
                    </div>
                    <div class="fps-meter">
                        <span class="fps-val" id="fpsValue">0</span> <span class="fps-unit">FPS</span>
                    </div>
                </div>

            </aside>
        </main>

        <!-- Footer -->
        <footer class="glass-footer">
            <p>PlexaMotion 5.0 | Built with <span class="highlight">MediaPipe</span> & Open Technologies</p>
        </footer>

    </div>

    <!-- Application Mode Modal -->
    <div id="appModeModal" class="glass-bg-overlay">
        <div class="glass-card modal-content">
            <h2>Select Application Mode</h2>
            <div class="mode-buttons-grid">
                <button id="startFitnessBtn" class="action-btn">
                    <span class="material-icons">fitness_center</span>
                    <div>
                        <strong>Fitness AI</strong>
                        <small>Exercise Tracking</small>
                    </div>
                </button>
                <button id="startGameBtn" class="action-btn">
                    <span class="material-icons">sports_esports</span>
                    <div>
                        <strong>Motion Game</strong>
                        <small>Interactive Fun</small>
                    </div>
                </button>
                <button id="startGestureBtn" class="action-btn">
                    <span class="material-icons">waving_hand</span>
                    <div>
                        <strong>Gesture Control</strong>
                        <small>Hands-Free Control</small>
                    </div>
                </button>
            </div>
            <div class="remote-link-section">
                <button id="showRemoteLinkBtn" class="text-btn">
                    Use Remote Sensor Link
                    <span class="material-icons">arrow_forward</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Connection Modal (Now for PeerJS) -->
    <div id="connectionModal" class="glass-bg-overlay hidden">
        <div class="glass-card modal-content">
            <button id="backToAppModeBtn" class="back-btn" title="Go Back">
                <span class="material-icons">arrow_back</span>
            </button>
            <h2>Remote Sensor Link</h2>
            <div class="mode-buttons">
                <button id="startHostBtn" class="action-btn">
                    <span class="material-icons">desktop_windows</span>
                    <div>
                        <strong>Laptop Display</strong>
                        <small>View Data Remotely</small>
                    </div>
                </button>
                <button id="startSensorBtn" class="action-btn outline">
                    <span class="material-icons">smartphone</span>
                    <div>
                        <strong>Phone Sensor</strong>
                        <small>Send Data</small>
                    </div>
                </button>
            </div>

            <!-- Host Panel -->
            <div id="hostPanel" class="hidden panel-section">
                <p>Your ID (Enter this on Phone):</p>
                <div class="id-display" id="myPeerId">Generating...</div>
                <p class="status-text" id="connectionStatus">Waiting for connection...</p>
            </div>

            <!-- Client Panel -->
            <div id="clientPanel" class="hidden panel-section">
                <input type="text" id="remotePeerIdInput" placeholder="Enter Laptop ID (e.g. 12ab34)"
                    class="glass-input">
                <button id="connectBtn" class="connect-btn">CONNECT</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- PeerJS -->
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <!-- Load MediaPipe Tasks Vision Bundle -->
    <script type="module" src="script.js"></script>
</body>

</html>
